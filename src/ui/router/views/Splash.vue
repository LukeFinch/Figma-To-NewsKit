<template>
<main>
<img id="logo" src="../../assets/thememanagerlogo.svg"/>
<div id="illustration">
<svg id="solarsystem" width="826" height="549" viewBox="0 0 826 549" fill="none" xmlns="http://www.w3.org/2000/svg">
<mask id="mask0" mask-type="alpha" maskUnits="userSpaceOnUse" x="223" y="102" width="345" height="345">
<path d="M359.086 139.136C284.178 159.208 239.687 236.064 259.713 310.8C279.738 385.536 356.697 429.85 431.604 409.779C506.512 389.707 551.003 312.851 530.978 238.115C510.952 163.379 433.994 119.065 359.086 139.136Z" fill="white"/>
</mask>
<mask id="mask1" mask-type="alpha" maskUnits="userSpaceOnUse" x="223" y="102" width="345" height="345">
<path d="M359.086 139.136C284.178 159.208 239.687 236.064 259.713 310.8C279.738 385.536 356.697 429.85 431.604 409.779C506.512 389.707 551.003 312.851 530.978 238.115C510.952 163.379 433.994 119.065 359.086 139.136Z" fill="white"/>
</mask>
<g id="planet" mask="url(#mask1)">
<path d="M359.086 139.136C284.178 159.208 239.687 236.064 259.713 310.8C279.738 385.536 356.697 429.85 431.604 409.779C506.512 389.707 551.003 312.851 530.978 238.115C510.952 163.379 433.994 119.065 359.086 139.136Z" fill="#0F1D32"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M533.629 251.362C520.885 177.574 479.825 160.465 478.88 159.958C451.246 145.171 390.873 117.806 348.342 133.078C305.812 148.349 263.205 239.273 307.824 283.12C348.144 322.742 341.223 367.254 369.648 383.374C398.073 399.493 438.566 400.739 477.083 382.139C515.601 363.539 546.372 325.15 533.629 251.362Z" fill="#233A5C"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M527.38 184.438C559.746 230.227 546.952 261.074 546.717 261.844C539.844 284.335 530.641 315.446 499.883 329.95C469.124 344.453 419.315 330.271 418.27 329.894C397.583 322.434 397.692 287.887 385.079 266.048C371.528 242.585 360.912 222.339 367.5 198.723C374.087 175.107 404.968 158.513 427.866 145.297C450.192 132.411 495.015 138.65 527.38 184.438Z" fill="#425E88"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M530.691 189.61C549.264 215.887 541.923 233.589 541.788 234.03C537.843 246.937 532.562 264.791 514.911 273.114C497.26 281.437 468.676 273.298 468.076 273.082C456.205 268.801 456.268 248.976 449.03 236.443C441.253 222.978 435.161 211.36 438.941 197.808C442.722 184.255 460.443 174.732 473.584 167.148C486.396 159.753 512.118 163.334 530.691 189.61Z" fill="#6883AB"/>
</g>
<path class="dashed" d="M549.463 334.388C609.833 363.716 645.445 389.544 640.782 404.025C632.081 431.044 486.454 408.324 315.514 353.277C144.574 298.23 13.0534 231.702 21.7544 204.683C28.6731 183.198 122.168 193.163 246.124 225.822" stroke="#AEBFFF" stroke-width="3" stroke-miterlimit="5.75877" stroke-linecap="round" stroke-dasharray="4 20"/>
<path class="dashed" d="M514.652 189.782C652.89 129.629 764.943 99.971 775.646 122.697C787.74 148.378 665.838 231.224 503.37 307.739C340.902 384.255 199.391 425.465 187.296 399.784C181.233 386.909 208.849 359.666 258.372 326.055" stroke="#AEBFFF" stroke-width="3" stroke-miterlimit="5.75877" stroke-linecap="round" stroke-dasharray="4 20"/>
<circle id="moon1"  r="14.8667" fill="#F88B7C"/>
<circle id="moon2"  r="36.2812" fill="#65BBC4"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M814.483 487.376C809.956 461.168 795.373 455.091 795.037 454.911C785.222 449.659 763.779 439.94 748.672 445.364C733.566 450.788 718.433 483.083 734.281 498.656C748.602 512.729 746.144 528.539 756.24 534.264C766.336 539.99 780.718 540.432 794.399 533.826C808.08 527.219 819.009 513.584 814.483 487.376Z" fill="#233A5C"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M96.5725 372.792C94.8863 363.028 89.4531 360.765 89.3279 360.698C85.6713 358.741 77.6826 355.12 72.0547 357.141C66.4269 359.161 60.7891 371.193 66.6932 376.995C72.0284 382.238 71.1127 388.128 74.874 390.261C78.6353 392.394 83.9935 392.559 89.0903 390.097C94.187 387.636 98.2588 382.556 96.5725 372.792Z" fill="#233A5C"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M76.5723 20.7925C74.886 11.0285 69.4528 8.7646 69.3277 8.69763C65.6711 6.74094 57.6823 3.11983 52.0545 5.14064C46.4266 7.16145 40.7888 19.1928 46.693 24.9948C52.0282 30.2377 51.1125 36.1278 54.8738 38.2608C58.6351 40.3938 63.9932 40.5587 69.09 38.0974C74.1868 35.6362 78.2585 30.5564 76.5723 20.7925Z" fill="#233A5C"/>
<path id="moon1path" d="M501.036 302.712C419.828 341.204 344.018 371.192 287.1 388.563C258.637 397.25 234.92 402.775 217.622 404.635C208.97 405.566 201.956 405.576 196.769 404.622C191.563 403.665 188.325 401.764 187.011 398.991C185.697 396.218 186.274 392.508 188.829 387.873C191.375 383.253 195.824 377.83 202.022 371.722C214.413 359.511 233.705 344.65 258.449 328.117C307.93 295.056 379.139 255.359 460.346 216.867C541.553 178.376 617.364 148.387 674.282 131.016C702.745 122.33 726.462 116.805 743.76 114.944C752.411 114.013 759.426 114.003 764.613 114.957C769.819 115.914 773.057 117.816 774.371 120.588C775.685 123.361 775.108 127.071 772.553 131.707C770.007 136.326 765.558 141.749 759.36 147.857C746.969 160.069 727.677 174.93 702.933 191.463C653.452 224.524 582.243 264.221 501.036 302.712Z" stroke="transparent"/>
<path id="moon2path" d="M315.694 349.322C400.423 377.206 478.8 397.345 537.02 407.366C566.134 412.377 590.186 414.854 607.463 414.511C616.106 414.339 623.022 413.462 628.019 411.861C633.034 410.254 635.996 407.96 636.956 405.044C637.916 402.128 636.895 398.523 633.815 394.252C630.745 389.995 625.701 385.183 618.85 379.912C605.153 369.375 584.331 357.084 557.931 343.825C505.139 317.311 430.12 286.967 345.391 259.083C260.662 231.198 182.286 211.059 124.065 201.039C94.9512 196.028 70.8994 193.551 53.6216 193.894C44.9795 194.066 38.0635 194.942 33.0657 196.544C28.0508 198.15 25.0888 200.445 24.1291 203.361C23.1694 206.277 24.19 209.882 27.2705 214.153C30.3406 218.409 35.384 223.222 42.2352 228.492C55.9322 239.029 76.7542 251.321 103.154 264.579C155.946 291.093 230.965 321.437 315.694 349.322Z" stroke="transparent"/>
</svg>
</div>
</main>

</template>

<script>
import { onMounted } from 'vue'
import { handleEvent, dispatch } from '../../uiMessageHandler'
import { useStore } from '../../store/store'
import router from '../index'
export default {
 setup(){
     const store = useStore()
     onMounted(() => {
     dispatch('splashReady')
    //Login the user with the key we have in storage
     handleEvent('figmaKey', key => {  
    let url = 'https://api.figma.com/v1/me'
      fetch(url,{'headers': {'X-Figma-Token': key}})
      .then(
        response => response.json().then(data => {handleResponse(data)}),
        rejected => handleRejection(rejected)
      );
    function handleRejection(rejected){
        router.push({path: 'authenticate'})
    }
    function handleResponse(data){
              if(data.status){
                  //key failed
                  dispatch('saveFigmaKey', null)
                  router.push({path: 'authenticate'})
            } else {
                store.setFigmaKey(key)
                store.setUser(data.handle, data.img_url, true)
                router.push({path: 'main'})
                dispatch('saveFigmaKey', key)
            }
     
        }
      });
     })

     return{

     }
 }
}
</script>

<style lang="scss" scoped>
main{
    position: absolute;
    top: 0px;

}
#logo{
    position: fixed;
    margin: auto;
    bottom: 20px;
    height: 32px;
    transform: translateX(calc(-50% - 5px));
    left: 50%;
}
#illustration{
    max-width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    
    svg{
        max-width: 71%;
        max-height: 100vh;
        transform: translate(10px, -5px);
        margin: auto;
    }
}
</style>

<style scoped>
#moon1{
  position: relative;
  offset-path: path('M501.036 302.712C419.828 341.204 344.018 371.192 287.1 388.563C258.637 397.25 234.92 402.775 217.622 404.635C208.97 405.566 201.956 405.576 196.769 404.622C191.563 403.665 188.325 401.764 187.011 398.991C185.697 396.218 186.274 392.508 188.829 387.873C191.375 383.253 195.824 377.83 202.022 371.722C214.413 359.511 233.705 344.65 258.449 328.117C307.93 295.056 379.139 255.359 460.346 216.867C541.553 178.376 617.364 148.387 674.282 131.016C702.745 122.33 726.462 116.805 743.76 114.944C752.411 114.013 759.426 114.003 764.613 114.957C769.819 115.914 773.057 117.816 774.371 120.588C775.685 123.361 775.108 127.071 772.553 131.707C770.007 136.326 765.558 141.749 759.36 147.857C746.969 160.069 727.677 174.93 702.933 191.463C653.452 224.524 582.243 264.221 501.036 302.712Z');
animation: move 30s infinite reverse linear, moon1fade 30s infinite reverse ease-in-out; 

}
#moon2{
  offset-path: path('M315.694 349.322C400.423 377.206 478.8 397.345 537.02 407.366C566.134 412.377 590.186 414.854 607.463 414.511C616.106 414.339 623.022 413.462 628.019 411.861C633.034 410.254 635.996 407.96 636.956 405.044C637.916 402.128 636.895 398.523 633.815 394.252C630.745 389.995 625.701 385.183 618.85 379.912C605.153 369.375 584.331 357.084 557.931 343.825C505.139 317.311 430.12 286.967 345.391 259.083C260.662 231.198 182.286 211.059 124.065 201.039C94.9512 196.028 70.8994 193.551 53.6216 193.894C44.9795 194.066 38.0635 194.942 33.0657 196.544C28.0508 198.15 25.0888 200.445 24.1291 203.361C23.1694 206.277 24.19 209.882 27.2705 214.153C30.3406 218.409 35.384 223.222 42.2352 228.492C55.9322 239.029 76.7542 251.321 103.154 264.579C155.946 291.093 230.965 321.437 315.694 349.322Z');
 animation: move 50s infinite linear, moon2fade 50s infinite ease-in-out;
}

@keyframes moon1fade {
  0% {
    opacity: 100%;
  }
  30%{
    transform: scale(1);
    opacity: 100%
  }
  33%{
    transform: scale(0.7);
    opacity: 0%;
  }
  55%{
    transform: scale(0.7);
    opacity: 0%;
  }
  58%{
    transform: scale(1);    
    opacity: 100%
  }
  100% {
    transform: scale(1);
    opacity: 100%;
  }
}
@keyframes move{
  0%{
    offset-distance: 0%;
   }
  100%{
    offset-distance: 100%
  }
}
@keyframes moon2fade {
  0% {
    opacity: 100%;
  }
  28%{
    opacity: 100%;
    transform: scale(1);
  }
  34%{
    opacity: 0%;
    transform: scale(0.9);
  }
  58%{
    opacity: 0%;
    transform: scale(0.9);
  }
  63%{    
    opacity: 100%;
    transform: scale(1);
  }
  100% {
    transform: scale(1);
    opacity: 100%;
  }
}
@keyframes planet {
  0%{
    transform: rotate(0deg)
  }
  100% {
    transform: rotate(360deg)
  }
}

main {
  background: #192C48;
}

#planet{
 position: relative;
 transform-origin: center;
}

#solarsystem {
  overflow: visible;
}

.dashed {
  animation: dash 60s infinite linear;
}

@keyframes dash {
  to {
    stroke-dashoffset: 100%;
  }
}



</style>